<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doze Studio | Scroll Animation</title>
    <link rel="stylesheet" href="https://unpkg.com/lenis@1.3.16/dist/lenis.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ensuring the canvas doesn't have scrollbars */
        canvas {
            display: block;
            max-width: 100vw;
            max-height: 100vh;
        }
        /* Custom Loading Bar Styles */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #18181b;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body class="bg-zinc-900">

    <div id="loader" class="loader text-white font-mono text-xl">
        LOADING: <span id="loading-text">0%</span>
    </div>

    <div class="w-full">
        <div class="parent relative w-full h-[1200vh]">
            <div class="w-full sticky top-0 left-0 h-screen overflow-hidden">
                
                <canvas id="canvas" class="relative z-0"></canvas>

                <div class="animate1 absolute bottom-10 left-10 z-10 text-white w-full md:w-1/2 pointer-events-none">
                    <h1 class="leading-tight font-light text-2xl md:text-3xl opacity-80">
                        &copy; 2024 DOZE STD
                    </h1>
                    <h1 class="text-3xl md:text-5xl font-bold uppercase tracking-tighter">
                        Shaping Brands <br> 
                        <span class="text-zinc-500">-> Crafting Motion</span>
                    </h1>
                </div>

                <div class="animate2 absolute flex bottom-10 right-10 z-10 text-white text-right w-full md:w-1/2 pointer-events-none opacity-0">
                    <h1 class="leading-20 font-bold text-6xl uppercase ">
                        Transforming Visions
                    </h1>
                    <h1 class="text-xl w-1/2">
                        Building identity and inspiring action.Sculpting digital experience resonate.
                     
                    </h1>
                </div>

                <div class="animate3 absolute z-10 text-white top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center opacity-0">
                    <h1 class="leading-20 font-weight-100 text-6xl uppercase ">
                        Elevating Aesthetics
                    </h1>
                    <h1 class="text-xl">
                        Crafting Solutions and exploring new horizons.Evolving narratives addEventListener
                        elevating aesthetics in every projects.
                    </h1>
                </div>

                <div class="w-1/3 panel translate-x-full  h-screen bg-white absolute right-0 top-0 z-10 p-10">
                    <h3 class="panelelem text-xl font-weight-100 ">
                        &copy; 2024 Doze.Std
                    </h3>
                    <p class="panelelem mt-9 text-xl">
                        Sculpting Digital Transforming visions into digital realities. Weaving stories that captivate and innovate. Exploring new possibilities with a focus on narrative evolution. Crafting solutions that engage and elevate.
                    </p>
                    <button class="panelelem border-2 px-6 p-2 hover:bg-gray-200 border-[#555] font-thin mt-6 ">
                        Get Reviews
                    </button>

                    <div class="panelelem absolute bottom-10">
                        <h3 class="text-xl">Innovating Design</h3>
                        <p class="text-sm mt-3">Connecting ideas to faster creativity> Designing impactful experiences that resonate.
                            Feel free to mix and match these sections to suit your website's design needs!
                        </p>
                        <button class="bg-black text-white
                        px-7 text-sm mt-4 py-4 font-thin capitalize"> experience</button>
                    </div>
                </div>

                <div class="absolute z-10 panelism opacity-0 text-white top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-conter text-6xl tracking-tighter ">
                    &copy;Panelism
                    <span class="line w-10 h-1 bg-white inline-block"></span>2048
                </div>
                

            </div>
        </div>
        <div class="w-full py-32 px-10 bg-white">
            <h1 class="text-6xl tracking-tighter">&reg; Our Recent Works.</h1>
            <div class="w-1/2 p-2 headings flex flex-col gap-10 mt-32">
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Google</h3>
                <h3 class="text-4xl">Apple</h3>
                <h3 class="text-4xl">samgsung</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
                <h3 class="text-4xl">Zonk Blerp</h3>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lenis@1.3.16/dist/lenis.min.js"></script> 
    <script>
        const canvas = document.querySelector("#canvas");
        const context = canvas.getContext("2d");
        const loadingText = document.querySelector("#loading-text");
        const loader = document.querySelector("#loader");

        const frames = {
            currentIndex: 0,
            maxIndex: 1345
        };

        const images = [];
        let imagesLoaded = 0;

        // 1. Preload Images
        function preloadImages() {
            for (let i = 1; i <= frames.maxIndex; i++) {
                const imageUrl = `../frames/frame_${i.toString().padStart(4, "0")}.jpeg`;
                const img = new Image();
                img.src = imageUrl;
                
                img.onload = function () {
                    imagesLoaded++;
                    // Update loading text
                    loadingText.innerText = Math.floor((imagesLoaded / frames.maxIndex) * 100) + "%";
                    
                    if (imagesLoaded === frames.maxIndex) {
                        // Hide loader and start
                        gsap.to(loader, {
                             opacity: 0,
                             duration: 0.5, 
                             onComplete: () => loader.style.display = "none" });
                        renderImage(frames.currentIndex);
                        startAnimation();
                    }
                };
                
                img.onerror = function() {
                    // Fallback if image fails to load to prevent sticking at 99%
                    imagesLoaded++;
                };
                
                images.push(img);
            }
        }

        // 2. Render Frame to Canvas
        function renderImage(index) {
            if (index >= 0 && index < frames.maxIndex) {
                const img = images[index];

                // Set canvas size to match window
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                // "Object-fit: cover" logic for Canvas
                const scaleX = canvas.width / img.width;
                const scaleY = canvas.height / img.height;
                const scale = Math.max(scaleX, scaleY);

                const newWidth = img.width * scale;
                const newHeight = img.height * scale;

                const offsetX = (canvas.width - newWidth) / 2;
                const offsetY = (canvas.height - newHeight) / 2;

                context.clearRect(0, 0, canvas.width, canvas.height);
                context.imageSmoothingEnabled = true;
                context.imageSmoothingQuality = "high";
                context.drawImage(img, offsetX, offsetY, newWidth, newHeight);
            }
        }

        // 3. GSAP Scroll Trigger
        function startAnimation() {
            var tl = gsap.timeline({
                scrollTrigger: {
                    trigger: ".parent",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 2, // Smoothness of scroll (lower is faster)
                }
            });

            function updateFrame(index){
                return{
                currentIndex: index,
                ease: "linear",
                onUpdate: function () {
                    renderImage(Math.floor(frames.currentIndex));
                }
            }
            }
            tl
            .to(frames,updateFrame(50),"first" )
            .to(".animate1",{ opacity:0, ease: "linear"},"first")

            .to(frames, updateFrame(100),"second")
            .to(".animate2",{ opacity:1 , ease: "linear"},"second ")

            .to(frames,updateFrame(150),"third")
            .to(".animate2",{opacity:1,ease:"linear"},"third")

            .to(frames,updateFrame(200),"fourth")
            .to(".animate2",{opacity:0,ease:"linear"},"fourth")

            .to(frames,updateFrame(300),"fifth")
            .to(".animate3",{opacity:1,ease:"linear"},"fifth")

            .to(frames,updateFrame(510),"sixth")
            .to(".animate3",{opacity:1,ease:"linear"},"sixth")

            .to(frames,updateFrame(600),"seventh")
            .to(".animate3",{opacity:0,ease:"linear"},"seventh")

            .to(frames,updateFrame(700),"eight")
            .to(".panel",{x:"0%",ease:"expo"},"eight")

            .to(frames,updateFrame(730),"ninth")
            .to(".panel",{x:"0%",ease:"expo"},"ninth")

            .to(frames,updateFrame(780),"tenth")
            .to(".panel",{opacity:0,ease:"linear"},"tenth")

            .to(frames,updateFrame(800),"eleventh")
            .to("canvas",{scale:.5,ease:"linear"},"eleventh")

            .to(frames,updateFrame(880),"twelvth")
            .to(".panelism",{opacity:1,ease:"expo"},"twelvth")

            .to(frames,updateFrame(980),"twelvth")
            .to(".panelism span",{width:200,duration:.5,ease:"expo"},"twelvth")
            
            .to(frames,updateFrame(1100),"thirtheen")
            .to("canvas",{scale:1,ease:"linear"},"thirtheem")

            .to(frames,updateFrame(1200),"fourteen")
            .to(".panelism",{scale:2,ease:"circ"},"fourteen")

            .to(frames,updateFrame(1345),"fifteen")
            .to(".panelism",{scale:2,ease:"circ"},"fifteen")

            
        

            // Optional: Animate the text as you scroll
            gsap.to(".animate1", {
                scrollTrigger: {
                    trigger: ".parent",
                    start: "top top",
                    end: "20% top",
                    scrub: true
                },
                opacity: 0,
                y: -50
            });

            
        }

         // Initialize Lenis
        const lenis = new Lenis({
        autoRaf: true,
        });
        function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);
        

        // 4. Handle Resize
        window.addEventListener("resize", function () {
            renderImage(Math.floor(frames.currentIndex));
        });

        preloadImages();

        document.querySelectorAll(".headings h3")
        .forEach(function(elem){
            gsap.from(elem,{
                scrollTrigger:{
                    trigger:elem,
                    start:"top 90%",
                    end: "bottom 20%",
                    scrub: 2
                },
                opacity:.3
            })
        })
    </script>
</body>
</html>